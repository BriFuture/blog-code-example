(function(t){function e(e){for(var r,s,o=e[0],h=e[1],l=e[2],c=0,f=[];c<o.length;c++)s=o[c],n[s]&&f.push(n[s][0]),n[s]=0;for(r in h)Object.prototype.hasOwnProperty.call(h,r)&&(t[r]=h[r]);u&&u(e);while(f.length)f.shift()();return a.push.apply(a,l||[]),i()}function i(){for(var t,e=0;e<a.length;e++){for(var i=a[e],r=!0,s=1;s<i.length;s++){var h=i[s];0!==n[h]&&(r=!1)}r&&(a.splice(e--,1),t=o(o.s=i[0]))}return t}var r={},n={index:0},a=[];function s(t){return o.p+"js/"+({}[t]||t)+"."+{"chunk-2d221f75":"9d307733"}[t]+".js"}function o(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(t){var e=[],i=n[t];if(0!==i)if(i)e.push(i[2]);else{var r=new Promise(function(e,r){i=n[t]=[e,r]});e.push(i[2]=r);var a,h=document.createElement("script");h.charset="utf-8",h.timeout=120,o.nc&&h.setAttribute("nonce",o.nc),h.src=s(t),a=function(e){h.onerror=h.onload=null,clearTimeout(l);var i=n[t];if(0!==i){if(i){var r=e&&("load"===e.type?"missing":e.type),a=e&&e.target&&e.target.src,s=new Error("Loading chunk "+t+" failed.\n("+r+": "+a+")");s.type=r,s.request=a,i[1](s)}n[t]=void 0}};var l=setTimeout(function(){a({type:"timeout",target:h})},12e4);h.onerror=h.onload=a,document.head.appendChild(h)}return Promise.all(e)},o.m=t,o.c=r,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(i,r,function(e){return t[e]}.bind(null,r));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/",o.oe=function(t){throw console.error(t),t};var h=window["webpackJsonp"]=window["webpackJsonp"]||[],l=h.push.bind(h);h.push=e,h=h.slice();for(var c=0;c<h.length;c++)e(h[c]);var u=l;a.push([0,"chunk-vendors"]),i()})({0:function(t,e,i){t.exports=i("56d7")},"034f":function(t,e,i){"use strict";var r=i("64a9"),n=i.n(r);n.a},3855:function(t,e,i){},"56d7":function(t,e,i){"use strict";i.r(e);i("cadf"),i("551c"),i("f751"),i("097d");var r=i("2b0e"),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-container",{attrs:{fluid:"",id:"app"}},[i("canvas",{ref:"canvas",attrs:{id:"canvas",width:t.canvasWidth,height:t.canvasHeight}}),i("div",[i("b-row",{staticClass:"panel"},[i("b-col",{staticClass:"full-height px-0 float-right subpanel",style:{height:t.canvasHeight+"px"},attrs:{cols:"6",md:"3",lg:"2"}},[i("c-sidebar",{directives:[{name:"show",rawName:"v-show",value:t.showSidebar,expression:"showSidebar"}],ref:"sidebar"})],1),i("b-col",{ref:"panel",attrs:{cols:"6",md:"6",lg:"8"}},[i("b-checkbox",{staticClass:"d-inline-block mx-4",model:{value:t.showSidebar,callback:function(e){t.showSidebar=e},expression:"showSidebar"}},[t._v("显示控制面板")]),i("b-checkbox",{staticClass:"d-inline-block mx-4",model:{value:t.showDebugInfo,callback:function(e){t.showDebugInfo=e},expression:"showDebugInfo"}},[t._v("显示调试信息")])],1),i("b-col",{staticClass:"full-height",style:{height:t.canvasHeight+"px"},attrs:{cols:"6",md:"3",lg:"2"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showDebugInfo,expression:"showDebugInfo"}],staticClass:"subpanel"},[i("c-debug-panel",{attrs:{data:t.data},on:{valueChanged:function(e){return t.debugValueChanged(e)}}}),i("c-information",{attrs:{data:t.data}})],1)])],1)],1)])},a=[],s=i("f499"),o=i.n(s),h=i("59ad"),l=i.n(h),c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("b-checkbox",{on:{change:function(e){return t.setSceneRun(e)}},model:{value:t.scene.running,callback:function(e){t.$set(t.scene,"running",e)},expression:"scene.running"}},[t._v("实时更新 3D 图像")]),i("craft-setting",{attrs:{craft:t.craft},on:{initCraft:function(e){return t.initCraft()}}}),i("b-card",{attrs:{header:"其他参数设置"}},[i("div",{staticClass:"option"},[i("b-checkbox",{model:{value:t.sensorPath.visible,callback:function(e){t.$set(t.sensorPath,"visible",e)},expression:"sensorPath.visible"}},[t._v("绘制路径")]),i("b-btn",{on:{click:function(e){return t.resetPath()}}},[t._v("重置路径")]),i("div",[t._v("轨迹宽度 "+t._s(t.pathWidth)+"\r\n        "),i("b-form-input",{attrs:{type:"range",id:"pathWidth",value:t.pathWidth,min:"1",max:"100"},on:{change:function(e){return t.setPathWidth(e)}}})],1),i("b-checkbox",{model:{value:t.refCircle.visible,callback:function(e){t.$set(t.refCircle,"visible",e)},expression:"refCircle.visible"}},[t._v("显示修正圆圈")])],1),i("div",{staticClass:"action"},[i("b-btn",{staticClass:"mx-4",on:{click:function(e){return t.recordPoint()}}},[t._v("打点")]),i("b-btn",{staticClass:"mx-4",on:{click:function(e){return t.resetRecordedPoint()}}},[t._v("重置打点")])],1),i("div",[t._v("指示器大小: "+t._s(t.indicatorSize.toFixed(1))+"\r\n      "),i("b-form-input",{attrs:{type:"range",id:"indicatorSize",value:t.indicatorSize,min:"1",max:"100"},on:{change:function(e){return t.setIndicatorSize(e)}}})],1),i("div",{},[t._v("修正圆圈大小\r\n      "),i("b-form-input",{attrs:{type:"range",id:"refCircleSize",value:t.refCircle.size,min:"0.1",max:"1",step:"0.01"},on:{change:function(e){return t.setRefCircleSize(e)}}})],1)]),i("camera-setting",{attrs:{camera:t.camera}}),i("sphere-setting",{attrs:{sphere:t.sphere}})],1)},u=[],f=i("d225"),d=i("b0b4"),v={gl:"not initialized"},g={heading:0,pitch:0,roll:0},p={},m={},x=(i("af56"),i("63d9"),i("308d")),b=i("6bb5"),_=i("4e2b"),A=function(){function t(e){Object(f["a"])(this,t),void 0===e&&(e={}),this.sides=e.sides||24,this.alpha=e.alpha||1,this.color=e.color||[.8,.8,.8],this.size=e.size||1,this.gl=e.gl,this.buffers={},this.mMatrix=mat4.create(),this.pvMatrix=mat4.create(),this.mvpMatrix=mat4.create(),this.quat=quat.create(),this.vscale=vec3.fromValues(1,1,1),this.translation=vec3.create(),this.visible=!0,this._x=0,this._y=0,this._z=0,this._rotateX=0,this._rotateY=0,this._rotateZ=0}return Object(d["a"])(t,[{key:"createArrayBuffer",value:function(t,e,i){var r=v.gl.createBuffer();return void 0===i&&(i=v.gl.ELEMENT_ARRAY_BUFFER,r.itemSize=t.itemSize||1,t instanceof Float32Array&&(i=v.gl.ARRAY_BUFFER,r.itemSize=t.itemSize||3),r.numItems=t.length/r.itemSize),v.gl.bindBuffer(i,r),v.gl.bufferData(i,t,e),v.gl.bindBuffer(i,null),r}},{key:"subBuffer",value:function(t,e,i){var r=v.gl.ELEMENT_ARRAY_BUFFER;i instanceof Float32Array&&(r=v.gl.ARRAY_BUFFER),v.gl.bindBuffer(r,t),v.gl.bufferSubData(r,e,i)}}]),t}();function y(t,e,i){var r=S(t,e),n=S(t,e,0,2*Math.PI,i),a=r.concat(n),s=[],o=0;for(o=1;o<e;o++)s.push(0,o+1,o);for(s.push(0,1,o),o=e+2;o<2*e+1;o++)s.push(e+1,o,o+1);for(s.push(e+1,o,e+2),o=1;o<e;o++)s.push(e+1+o,o,o+1),s.push(e+o+1,o+1,e+o+2);return s.push(e+1+o,o,1),s.push(e+o+1,1,e+2),{vertex:a,index:s}}function S(t,e,i,r,n){var a=[],s=0,o=0,h=n||0,l=i||0,c=r||2*Math.PI,u=(c-l)/e;a=a.concat([s,o,0]);for(var f=0;f<e;f++)s=Math.cos(f*u+l)*t,o=Math.sin(f*u+l)*t,a=a.concat([s,o,h]);return a}function C(t,e,i,r){for(var n=vec3.create(),a=r||0,s=0;s<t.length;s+=3)vec3.set(n,t[s+0],t[s+1],t[s+2]+a),vec3.rotateY(n,n,[0,0,0],e),vec3.rotateZ(n,n,[0,0,0],i),t[s+0]=n[0],t[s+1]=n[1],t[s+2]=n[2]}function P(t){return t*Math.PI/180}function M(t,e,i){var r=[],n=0;if(e.length<=3)if(void 0===i)for(n=0;n<t.length;n+=3)r=r.concat(t[n],t[n+1],t[n+2]),r=r.concat(e[0],e[1],e[2]);else if(i.length<=3)for(n=0;n<t.length;n+=3)r=r.concat(t[n],t[n+1],t[n+2]),r=r.concat(e[0],e[1],e[2]),r=r.concat(i[0],i[1],i[2]);else for(n=0;n<t.length;n+=3)r=r.concat(t[n],t[n+1],t[n+2]),r=r.concat(e[0],e[1],e[2]),r=r.concat(i[n],i[n+1],i[n+2]);else if(void 0===i)for(n=0;n<t.length;n+=3)r=r.concat(t[n],t[n+1],t[n+2]),r=r.concat(e[n],e[n+1],e[n+2]);else if(i.length<=3)for(n=0;n<t.length;n+=3)r=r.concat(t[n],t[n+1],t[n+2]),r=r.concat(e[n],e[n+1],e[n+2]),r=r.concat(i[0],i[1],i[2]);else for(n=0;n<t.length;n+=3)r=r.concat(t[n],t[n+1],t[n+2]),r=r.concat(e[n],e[n+1],e[n+2]),r=r.concat(i[n],i[n+1],i[n+2]);return r}function R(t,e,i){var r=Math.sin(t),n=Math.cos(t),a=Math.sin(e),s=Math.cos(e),o=i*r*s,h=i*r*a,l=i*n;return vec3.fromValues(o,h,l)}var E=function(t){function e(t){var i;return Object(f["a"])(this,e),i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.type="Coord",i.length=10,i.init(),i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"init",value:function(){var t=y(.01,this.sides,this.length);C(t.vertex,P(90),0);var e=M(t.vertex,[.9,.1,0],[1,1,1]),i=y(.01,this.sides,this.length);C(i.vertex,P(90),P(90));var r=M(i.vertex,[0,.9,0],[1,1,1]),n=y(.01,this.sides,this.length),a=M(n.vertex,[0,0,.9],[1,1,1]),s=[];s=s.concat(e),s=s.concat(r),s=s.concat(a);var o=[];o=o.concat(t.index);for(var h=2*this.sides+2,l=0;l<i.index.length;l++)o.push(h+i.index[l]);h=4*this.sides+4;for(l=0;l<n.index.length;l++)o.push(h+n.index[l]);this.buffers.vertex=this.createArrayBuffer(new Float32Array(s),v.gl.STATIC_DRAW),this.buffers.index=this.createArrayBuffer(new Uint16Array(o),v.gl.STATIC_DRAW),this.buffers.index.numItems=o.length}},{key:"paint",value:function(){v.gl.uniform1f(m.alpha,this.alpha),v.gl.uniformMatrix4fv(m.m_matrix,!1,this.mMatrix),v.gl.uniformMatrix4fv(m.pmv_matrix,!1,this.mvpMatrix),v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.buffers.vertex),v.gl.vertexAttribPointer(p.vertex_position,3,v.gl.FLOAT,!1,36,0),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,36,12),v.gl.vertexAttribPointer(p.vertex_normal,3,v.gl.FLOAT,!1,36,24),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.buffers.index),v.gl.drawElements(v.gl.TRIANGLES,this.buffers.index.numItems,v.gl.UNSIGNED_SHORT,0)}},{key:"onViewChanged",value:function(t){this.pvMatrix=t||this.pvMatrix,mat4.mul(this.mvpMatrix,this.pvMatrix,this.mMatrix)}}]),e}(A),O=E,w=function(){function t(e){Object(f["a"])(this,t),this.defaultTheta=45,this.defaultPhi=45,this.defaultDis=15,this.defaultViewWidth=800,this.defaultViewHeight=600,this.type="Camera",this.theta=e.theta||this.defaultTheta,this.theta=P(this.theta),this.phi=e.phi||this.defaultPhi,this.phi=P(this.phi),this.dis=e.dis||this.defaultDis,this.width=e.width||this.defaultViewWidth,this.height=e.height||this.defaultViewHeight,this.pos=R(this.theta,this.phi,this.dis),this.up=vec3.fromValues(0,0,1),this.lookat=vec3.fromValues(0,0,0),this.pMatrix=mat4.create(),this.vMatrix=mat4.create(),this.pvMatrix=mat4.create(),this.setSize(this.width,this.height)}return Object(d["a"])(t,[{key:"update",value:function(){mat4.lookAt(this.vMatrix,this.pos,this.lookat,this.up),mat4.mul(this.pvMatrix,this.pMatrix,this.vMatrix),void 0!==this.watcher&&this.watcher(this.pvMatrix)}},{key:"recv",value:function(t){this.watcher=t}},{key:"rotate",value:function(t,e,i){t&&(t<.01?t=.01:t>179.99&&(t=179.99),this.theta=P(t)),e&&(this.phi=P(e)),i&&(this.dis=i),this.pos=R(this.theta,this.phi,this.dis),this.update()}},{key:"setSize",value:function(t,e){this.width=t,this.height=e,v.gl.viewport(0,0,t,e),mat4.perspective(this.pMatrix,.25*Math.PI,t/e,.5,500),this.update()}},{key:"reset",value:function(){this.rotate(this.defaultTheta,this.defaultPhi,this.dis),this.update()}}]),t}(),T=function(){function t(e){Object(f["a"])(this,t);var i=v.gl;i.enable(i.DEPTH_TEST),i.depthFunc(i.LESS),i.enable(i.CULL_FACE),i.cullFace(i.BACK),i.clearColor(.97,.97,.97,1),i.clearDepth(1),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),this.type="Scene",this.objs=[],this.light_direct=[.35,.35,.7]}return Object(d["a"])(t,[{key:"add",value:function(t,e){void 0!==t?(e?this.objs.unshift(t):this.objs.push(t),void 0!==this.camera&&this.camera.update()):console.log("[Warn] Undefined on Scene adding.")}},{key:"addCamera",value:function(t){var e=this;this.camera=t,t.recv(function(t){for(var i=0;i<e.objs.length;i++)e.objs[i].onViewChanged(t)})}},{key:"render",value:function(){this.running=!0;var t=this;function e(){v.gl.clear(v.gl.COLOR_BUFFER_BIT|v.gl.DEPTH_BUFFER_BIT);for(var i=0;i<t.objs.length;i++)t.objs[i].visible&&t.objs[i].paint();t.running&&requestAnimationFrame(e)}requestAnimationFrame(e)}},{key:"getShader",value:function(t,e,i){var r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.log("JS:Shader compile failed"),console.log(t.getShaderInfoLog(r)),null)}},{key:"initShaders",value:function(t,e){var i=v.gl.createProgram(),r=this.getShader(v.gl,t,v.gl.VERTEX_SHADER);v.gl.attachShader(i,r);var n=this.getShader(v.gl,e,v.gl.FRAGMENT_SHADER);v.gl.attachShader(i,n),this._onShaderReady(i)}},{key:"_onShaderReady",value:function(t){v.gl.linkProgram(t),v.gl.useProgram(t),p.vertex_position=v.gl.getAttribLocation(t,"aVertexPosition"),v.gl.enableVertexAttribArray(p.vertex_position),p.vertex_normal=v.gl.getAttribLocation(t,"aVertexNormal"),v.gl.enableVertexAttribArray(p.vertex_normal),p.color=v.gl.getAttribLocation(t,"aColor"),v.gl.enableVertexAttribArray(p.color),p.texture=v.gl.getAttribLocation(t,"aTexture"),p.color=v.gl.getAttribLocation(t,"aColor"),m.pmv_matrix=v.gl.getUniformLocation(t,"uPMVMatrix"),m.m_matrix=v.gl.getUniformLocation(t,"uMMatrix"),m.n_matrix=v.gl.getUniformLocation(t,"uNMatrix"),m.alpha=v.gl.getUniformLocation(t,"uAlpha"),m.frag_color=v.gl.getUniformLocation(t,"uFragColor"),m.has_texture=v.gl.getUniformLocation(t,"uHasTexture"),m.light_direction=v.gl.getUniformLocation(t,"uLightDirection"),m.specColor=v.gl.getUniformLocation(t,"uSpecColor"),m.vertexColor=v.gl.getUniformLocation(t,"uVertColor"),v.gl.uniformMatrix4fv(m.n_matrix,!1,mat4.create()),v.gl.uniform3fv(m.light_direction,this.light_direct)}}]),t}(),B=function(t){function e(t){var i;return Object(f["a"])(this,e),i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.type="SensorPoint",i.inv_color=t.inv_color||[0,1,0],i.dis=4,g.pitch=0,g.heading=0,i.headingOffset=0,g.roll=0,i.callbacks=[],i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"init",value:function(){var t=y(this.size,this.sides,.01),e=t.vertex,i=t.index,r=0,n=[];for(r=0;r<=this.sides;r++)n=n.concat(this.inv_color);for(r=0;r<=this.sides;r++)n=n.concat(this.color);var a=M(e,n,[0,1,1]);this.index_count=i.length,this.vertexBuffer=this.createArrayBuffer(new Float32Array(a),v.gl.STATIC_DRAW),this.indexBuffer=this.createArrayBuffer(new Uint16Array(i),v.gl.STATIC_DRAW)}},{key:"paint",value:function(){v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.vertexBuffer),v.gl.vertexAttribPointer(p.vertex_position,3,v.gl.FLOAT,!1,36,0),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,36,12),v.gl.vertexAttribPointer(p.vertex_normal,3,v.gl.FLOAT,!1,36,24),v.gl.uniform1f(m.alpha,this.alpha),v.gl.uniformMatrix4fv(m.m_matrix,!1,this.mMatrix),v.gl.uniformMatrix4fv(m.pmv_matrix,!1,this.mvpMatrix),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),v.gl.drawElements(v.gl.TRIANGLES,this.index_count,v.gl.UNSIGNED_SHORT,0)}},{key:"onViewChanged",value:function(t){this.pvMatrix=t||this.pvMatrix,mat4.mul(this.mvpMatrix,this.pvMatrix,this.mMatrix)}},{key:"setScale",value:function(t){this.size=t,vec3.set(this.vscale,t,t,t),this.update()}},{key:"setTranslation",value:function(t,e,i){this.translation=R(P(e),P(i),t),quat.fromEuler(this.quat,0,e,i),this.update()}},{key:"setParam",value:function(t){this.dis=t.dis||this.dis,t.pitch&&(g.pitch=t.pitch),t.heading&&(g.heading=t.heading,t.heading=t.heading-this.headingOffset),t.roll&&(g.roll=t.roll);var e=90-g.pitch;this.setTranslation(this.dis,e,g.heading)}},{key:"update",value:function(){mat4.fromRotationTranslationScale(this.mMatrix,this.quat,this.translation,this.vscale),this.onViewChanged();for(var t=this.spherical(),e=0;e<this.callbacks.length;e++)this.callbacks[e].onSphericalChanged({dis:this.dis,pitch:g.pitch,heading:g.heading,roll:g.roll,theta:t[0],phi:t[1],size:this.size})}},{key:"addSphericalChange",value:function(t){this.callbacks.push(t)}},{key:"spherical",value:function(){var t=(90-g.pitch)/180*Math.PI,e=g.heading/180*Math.PI;return vec3.fromValues(t,e,this.dis)}},{key:"reset",value:function(){this.headingOffset+=g.heading,this.setParam({pitch:g.pitch,heading:g.heading,roll:g.roll,dis:this.dis})}}]),e}(A),k=4,F=2,L=6,I=function(t){function e(t){var i;return Object(f["a"])(this,e),i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.MaxPathIndexNum=4800*L*2,i.type="SensorPath",i.all_index_count=0,i.cur_path_count=0,i.cur_index_count=0,i.cur_pi=0,i.buffer_path_bytes=i.MaxPathIndexNum*k,i.buffer_index_bytes=i.MaxPathIndexNum*F,i.gap=1,i.pg=1,i.init(),i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"init",value:function(){this.angle=this.last_point,this.path=[],this.index=[],this.vertexBuffer=[],this.indexBuffer=[],this.createBuffer()}},{key:"paint",value:function(){v.gl.uniform1f(m.alpha,this.alpha),v.gl.uniformMatrix4fv(m.m_matrix,!1,this.mMatrix),v.gl.uniformMatrix4fv(m.pmv_matrix,!1,this.mvpMatrix);for(var t=0;t<this.cur_pi;t++)v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.vertexBuffer[t]),v.gl.vertexAttribPointer(p.vertex_normal,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.vertex_position,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,24,12),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer[t]),v.gl.drawElements(v.gl.TRIANGLES,this.MaxPathIndexNum,v.gl.UNSIGNED_SHORT,0);this.cur_index_count>0&&(v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.vertexBuffer[this.cur_pi]),v.gl.vertexAttribPointer(p.vertex_normal,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.vertex_position,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,24,12),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer[this.cur_pi]),v.gl.drawElements(v.gl.TRIANGLES,this.cur_index_count,v.gl.UNSIGNED_SHORT,0))}},{key:"onViewChanged",value:function(t){this.pvMatrix=t||this.pvMatrix,mat4.mul(this.mvpMatrix,this.pvMatrix,this.mMatrix)}},{key:"setGap",value:function(t){this.gap=t}},{key:"setSize",value:function(t){this.size=t}},{key:"getLinearPoint",value:function(t,e){var i,r=R(t[0],t[1],t[2]),n=R(e[0],e[1],e[2]),a=[r[0]-n[0],r[1]-n[1],r[2]-n[2]],s=R(.5*(t[0]+e[0]),.5*(t[1]+e[1]),t[2]),o=vec3.create();vec3.cross(o,a,s),vec3.normalize(o,o),vec3.scale(o,o,.02*this.size);var h=[],l=this.color,c=function(){h=h.concat(i),h=h.concat(l)};i=[r[0]-o[0],r[1]-o[1],r[2]-o[2]],c(),i=[r[0]+o[0],r[1]+o[1],r[2]+o[2]],c(),i=[n[0]-o[0],n[1]-o[1],n[2]-o[2]],c(),i=[n[0]+o[0],n[1]+o[1],n[2]+o[2]],c();var u=[],f=this.cur_path_count/L;return u.push(f+0,f+2,f+3,f+0,f+3,f+1),u.push(f+0,f+3,f+2,f+0,f+1,f+3),{vertices:new Float32Array(h),index:new Uint16Array(u)}}},{key:"onSphericalChanged",value:function(t){void 0===this.last_point&&(this.last_point=t);var e=R(this.last_point.theta,this.last_point.phi,this.last_point.dis),i=R(t.theta,t.phi,t.dis),r=vec3.dist(e,i),n=[t.theta,t.phi,t.dis];r>Math.PI*t.dis*.002&&(this._updateBuffer(n),this.angle=n,this.last_point=t)}},{key:"_updateBuffer",value:function(t){var e=[this.last_point.theta,this.last_point.phi,this.last_point.dis],i=this.getLinearPoint(t,e);this.all_index_count+=i.index.length,this.subBuffer(this.vertexBuffer[this.cur_pi],this.cur_path_count*k,i.vertices),this.subBuffer(this.indexBuffer[this.cur_pi],this.cur_index_count*F,i.index),this.cur_path_count+=i.vertices.length,this.cur_index_count+=i.index.length,this.cur_path_count>=this.MaxPathIndexNum&&(this.cur_pi++,console.info("Info: [Path] create a new buffer!\n"),this.createBuffer(),this.resetCurrentPath())}},{key:"resetCurrentPath",value:function(t){this.cur_path_count=0,this.cur_index_count=0,this.pg=0}},{key:"resetAllPath",value:function(t){for(var e=1;e<=this.cur_pi;e++)v.gl.deleteBuffer(this.vertexBuffer[e]),v.gl.deleteBuffer(this.indexBuffer[e]);this.all_index_count=0,this.cur_pi=0,this.last_point=void 0,this.resetCurrentPath()}},{key:"createBuffer",value:function(){this.vertexBuffer[this.cur_pi]=this.createArrayBuffer(this.buffer_path_bytes,v.gl.STATIC_DRAW,v.gl.ARRAY_BUFFER),this.indexBuffer[this.cur_pi]=this.createArrayBuffer(this.buffer_index_bytes,v.gl.STATIC_DRAW,v.gl.ELEMENT_ARRAY_BUFFER)}}]),e}(A),z=function(t){function e(t){var i;return Object(f["a"])(this,e),i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.type="RecordPoint",i.max_vertex=1e3*i.sides,i.vertex_count=0,i.index_count=0,i.init(),i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"init",value:function(){this.vertexBuffer=this.createArrayBuffer(4*this.max_vertex,v.gl.DYNAMIC_DRAW,v.gl.ARRAY_BUFFER),this.indexBuffer=this.createArrayBuffer(2*this.max_vertex,v.gl.DYNAMIC_DRAW,v.gl.ELEMENT_ARRAY_BUFFER)}},{key:"paint",value:function(){0!==this.vertex_count&&(v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.vertexBuffer),v.gl.vertexAttribPointer(p.vertex_normal,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.vertex_position,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,24,12),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),v.gl.uniform1f(m.alpha,this.alpha),v.gl.uniformMatrix4fv(m.m_matrix,!1,this.mMatrix),v.gl.uniformMatrix4fv(m.pmv_matrix,!1,this.mvpMatrix),v.gl.drawElements(v.gl.TRIANGLES,this.index_count,v.gl.UNSIGNED_SHORT,0))}},{key:"onViewChanged",value:function(t){this.pvMatrix=t||this.pvMatrix,mat4.mul(this.mvpMatrix,this.pvMatrix,this.mMatrix)}},{key:"setSize",value:function(t){this.size=t,vec3.fromValues(this.vscale,t,t,t),mat4.fromRotationTranslationScale(this.mMatrix,this.quat,this.translation,this.vscale),this.onViewChanged()}},{key:"record",value:function(){if(this.visible){console.log("[Info]: record a point.");var t=0,e=[],i=[];e=S(this.size,this.sides,0,2*Math.PI),C(e,this.theta,this.phi,this.dis);var r=M(e,[0,.5,.5]),n=this.vertex_count/6;for(t=1;t<this.sides;t++)i.push(n,n+t,n+t+1,n,n+t+1,n+t);i.push(n,n+this.sides,n+1,n,n+1,n+this.sides),this.subBuffer(this.vertexBuffer,4*this.vertex_count,new Float32Array(r)),this.subBuffer(this.indexBuffer,2*this.index_count,new Uint16Array(i)),this.vertex_count+=r.length,this.index_count+=i.length}}},{key:"onSphericalChanged",value:function(t){this.theta=t.theta,this.phi=t.phi,this.dis=1.01*t.dis,this.size=.95*t.size}},{key:"reset",value:function(){this.vertex_count=0,this.index_count=0}}]),e}(A),j=function(t){function e(t){var i;Object(f["a"])(this,e),i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.type="Craft";var r=t.size||1;return i.setScale(r),i.visible=!1,i.heading=0,i.pitch=0,i.roll=0,i.headingOffset=0,i.pitchOffset=0,i.rollOffset=0,t.obj&&i.init(t.obj),i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"init",value:function(t){var e=this;t.then(function(t){e.mesh=new OBJ.Mesh(t.default),OBJ.initMeshBuffers(v.gl,e.mesh),e.visible=!0})}},{key:"paint",value:function(){void 0!==this.mesh&&(v.gl.uniform1f(m.alpha,this.alpha),v.gl.uniform3fv(m.frag_color,[.8,.3,.6]),v.gl.uniform1i(m.specColor,1),v.gl.uniform3fv(m.vertexColor,this.color),v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.mesh.vertexBuffer),v.gl.vertexAttribPointer(p.vertex_position,this.mesh.vertexBuffer.itemSize,v.gl.FLOAT,!1,0,0),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,0,0),this.mesh.textures.length?(v.gl.enableVertexAttribArray(p.texture),v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.mesh.textureBuffer),v.gl.vertexAttribPointer(p.texture,this.mesh.textureBuffer.itemSize,v.gl.FLOAT,!1,0,0)):v.gl.disableVertexAttribArray(p.textureCoordAttribute),v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.mesh.normalBuffer),v.gl.vertexAttribPointer(p.vertex_normal,this.mesh.normalBuffer.itemSize,v.gl.FLOAT,!1,0,0),v.gl.uniformMatrix4fv(m.m_matrix,!1,this.mMatrix),v.gl.uniformMatrix4fv(m.pmv_matrix,!1,this.mvpMatrix),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.mesh.indexBuffer),v.gl.drawElements(v.gl.TRIANGLES,this.mesh.indexBuffer.numItems,v.gl.UNSIGNED_SHORT,0),v.gl.uniform1i(m.specColor,!1))}},{key:"onViewChanged",value:function(t){this.pvMatrix=t||this.pvMatrix,mat4.mul(this.mvpMatrix,this.pvMatrix,this.mMatrix)}},{key:"setRotation",value:function(t){this.pitch=t.pitch||this.pitch,this.heading=t.heading||this.heading,this.roll=t.roll||this.roll,mat4.fromScaling(this.mMatrix,this.vscale),mat4.rotateX(this.mMatrix,this.mMatrix,P(this.pitchOffset)),mat4.rotateY(this.mMatrix,this.mMatrix,P(this.heading+this.headingOffset)),mat4.rotateX(this.mMatrix,this.mMatrix,P(this.pitch)),mat4.rotateZ(this.mMatrix,this.mMatrix,P(this.roll)),this.onViewChanged()}},{key:"setScale",value:function(t){this.size=t,vec3.set(this.vscale,t,t,t),this.setRotation({})}}]),e}(A);j.prototype.onSphericalChanged=j.prototype.setRotation;var N=function(t){function e(t){var i;return Object(f["a"])(this,e),i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.MODE_SURFACE=0,i.MODE_LINE=1,i.MODE_LESSLINE=2,i.DEFAULT_RADIUS=4,i.type="Sphere",i.vn=t.vn||48,i.hn=.5*(t.hn||48),i.size=t.size||i.DEFAULT_RADIUS,i.drawMode=i.MODE_SURFACE,i.line_alpha=.65,i.alpha=t.alpha||.25,i.setSize(),i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"init",value:function(){var t=this.getVertex(),e=this.getIndex();this.vertexBuffer=this.createArrayBuffer(new Float32Array(t.vertices),v.gl.STATIC_DRAW),this.indexBuffer=this.createArrayBuffer(new Uint16Array(e.vertex_index),v.gl.STATIC_DRAW),this.lineIndexBuffer=this.createArrayBuffer(new Uint16Array(e.line_index),v.gl.STATIC_DRAW),this.lessLineIndexBuffer=this.createArrayBuffer(new Uint16Array(e.less_line_index),v.gl.STATIC_DRAW),this.lessLSIndexBuffer=this.createArrayBuffer(new Uint16Array(e.less_ls_index),v.gl.STATIC_DRAW)}},{key:"paint",value:function(){switch(v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.vertexBuffer),v.gl.vertexAttribPointer(p.vertex_position,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.vertex_normal,3,v.gl.FLOAT,!1,24,0),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,24,12),v.gl.uniformMatrix4fv(m.m_matrix,!1,this.mMatrix),v.gl.uniformMatrix4fv(m.pmv_matrix,!1,this.mvpMatrix),this.drawMode){case this.MODE_LINE:v.gl.uniform1f(m.alpha,this.line_alpha),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.lineIndexBuffer),v.gl.drawElements(v.gl.LINES,this.lineIndexBuffer.numItems,v.gl.UNSIGNED_SHORT,0);break;case this.MODE_LESSLINE:v.gl.uniform1f(m.alpha,this.line_alpha),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.lessLineIndexBuffer),v.gl.drawElements(v.gl.LINES,this.lessLineIndexBuffer.numItems,v.gl.UNSIGNED_SHORT,0),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.lessLSIndexBuffer),v.gl.drawElements(v.gl.TRIANGLES,this.lessLSIndexBuffer.numItems,v.gl.UNSIGNED_SHORT,0);break;case this.MODE_SURFACE:default:v.gl.uniform1f(m.alpha,this.alpha),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),v.gl.drawElements(v.gl.TRIANGLES,this.indexBuffer.numItems,v.gl.UNSIGNED_SHORT,0);break}}},{key:"onViewChanged",value:function(t){this.pvMatrix=t||this.pvMatrix,mat4.mul(this.mvpMatrix,this.pvMatrix,this.mMatrix)}},{key:"setSize",value:function(t){this.size=t||this.DEFAULT_RADIUS,vec3.set(this.vscale,this.size,this.size,this.size),mat4.fromScaling(this.mMatrix,this.vscale),this.onViewChanged()}},{key:"setDrawMode",value:function(t){this.drawMode=t}},{key:"setAlpha",value:function(t){this.alpha=t}},{key:"getVertex",value:function(){var t,e,i,r=[],n=[];for(e=0;e<=this.vn;e++)for(t=0;t<=this.hn;t++)i=R(P(180*t/this.hn),P(360*e/this.vn),1),n=n.concat(i[0],i[1],i[2]);return n=n.concat([0,0,0]),r=M(n,this.color),{vertices:r}}},{key:"getIndex",value:function(){var t=[],e=[],i=[],r=[],n=0,a=0;for(a=0;a<this.vn;a++)for(n=0;n<this.hn+1;n++)e.push(n+a*(this.hn+1),n+1+a*(this.hn+1),n+a*(this.hn+1),n+(a+1)*(this.hn+1)),t.push(n+a*(this.hn+1),n+1+a*(this.hn+1),n+1+(a+1)*(this.hn+1)),t.push(n+a*(this.hn+1),n+1+(a+1)*(this.hn+1),n+(a+1)*(this.hn+1));for(n=0;n<this.hn+1;n++)a=0,i.push(n+a*(this.hn+1),n+1+a*(this.hn+1)),a=.25*this.vn,i.push(n+a*(this.hn+1),n+1+a*(this.hn+1)),a=.5*this.vn,i.push(n+a*(this.hn+1),n+1+a*(this.hn+1)),a=.75*this.vn,i.push(n+a*(this.hn+1),n+1+a*(this.hn+1));for(a=0;a<this.vn;a++)n=this.hn/2,i.push(n+a*(this.hn+1),n+(a+1)*(this.hn+1));for(a=.5*this.vn;a<.75*this.vn;a++)r.push((this.vn+1)*(this.hn+1)),r.push(.5*this.hn+a*(this.hn+1)),r.push(.5*this.hn+(a+1)*(this.hn+1)),r.push((this.vn+1)*(this.hn+1)),r.push(.5*this.hn+(a+1)*(this.hn+1)),r.push(.5*this.hn+a*(this.hn+1));return{vertex_index:t,line_index:e,less_line_index:i,less_ls_index:r}}}]),e}(A),D=.03*Math.PI,U=function(t){function e(t){var i;Object(f["a"])(this,e),t=t||{},i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.dis=t.dis||4,i.visible=!1,i.current=-1;var r=[0,1,0],n=[0,0,1],a=0,s=0,o=0,h=[];for(h[o]=new V({pos:[0,0,i.dis],color:r,gl:v.gl}),o++,a=0;a<=2;a++)for(s=0;s<8;s++)h[o]=new V(1===a&&s%2===0?{pos:[45*(a+1),45*s,i.dis],color:r,gl:v.gl}:{pos:[45*(a+1),45*s,i.dis],color:n,gl:v.gl}),o++;return h[o]=new V({pos:[180,0,i.dis],color:r,gl:v.gl}),i.circles=h,i.setScale(t.size||1),i.init(),i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"init",value:function(){var t=1,e=S(t,this.sides,0,2*Math.PI),i=M(e,this.color,e),r=0,n=[];for(r=1;r<this.sides+1;r++)n.push(r);this.vertexBuffer=this.createArrayBuffer(new Float32Array(i),v.gl.STATIC_DRAW),this.indexBuffer=this.createArrayBuffer(new Uint16Array(n),v.gl.STATIC_DRAW)}},{key:"paint",value:function(){if(this.visible){v.gl.uniform1f(m.alpha,this.alpha),v.gl.uniform1i(m.specColor,1),v.gl.bindBuffer(v.gl.ARRAY_BUFFER,this.vertexBuffer),v.gl.vertexAttribPointer(p.vertex_position,3,v.gl.FLOAT,!1,36,0),v.gl.vertexAttribPointer(p.vertex_normal,3,v.gl.FLOAT,!1,36,12),v.gl.vertexAttribPointer(p.color,3,v.gl.FLOAT,!1,36,24),v.gl.bindBuffer(v.gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);for(var t=0;t<26;t++)v.gl.uniform3fv(m.vertexColor,this.circles[t].color),v.gl.uniformMatrix4fv(m.pmv_matrix,!1,this.circles[t].mvpMatrix),v.gl.drawElements(this.circles[t].drawMode,this.sides,v.gl.UNSIGNED_SHORT,0);v.gl.uniform1i(m.specColor,0)}}},{key:"onViewChanged",value:function(t){for(var e=0;e<26;e++)this.circles[e].onViewChanged(t)}},{key:"setDis",value:function(t){this.dis=t;for(var e=0;e<26;e++)this.circles[e].setTranslation(this.dis+.1)}},{key:"setScale",value:function(t){for(var e=0;e<26;e++)this.circles[e].setScale(t)}},{key:"onSphericalChanged",value:function(t){if(this.visible){var e;if(e=this.circles[0],Math.abs(t.theta-e.theta)<D)return e.setCurrent(t.size),void(this.current=0);if(e.current&&(e.unsetCurrent(),this.current=-1),e=this.circles[25],Math.abs(t.theta-e.theta)<D)return e.setCurrent(t.size),void(this.current=25);e.current&&(e.unsetCurrent(),this.current=-1);for(var i=1;i<25;i++)if(e=this.circles[i],Math.abs(t.phi-e.phi)<D&&Math.abs(t.theta-e.theta)<D){if(e.current)continue;e.setCurrent(t.size),this.current=i}else e.current&&(e.unsetCurrent(),this.current=-1)}}}]),e}(A),V=function(t){function e(t){var i;return Object(f["a"])(this,e),i=Object(x["a"])(this,Object(b["a"])(e).call(this,t)),i.type="SingleReferCircle",void 0!==t.pos&&(i.setTranslation(t.pos[2],P(t.pos[0]),P(t.pos[1])),i.setQuat(t.pos[0],t.pos[1])),i.current=!1,i.drawMode=v.gl.LINES,i.size=t.size||1,i.originColor=new Float32Array(t.color),i}return Object(_["a"])(e,t),Object(d["a"])(e,[{key:"onViewChanged",value:function(t){this.pvMatrix=t||this.pvMatrix,mat4.fromRotationTranslationScale(this.mMatrix,this.quat,this.translation,this.vscale),mat4.mul(this.mvpMatrix,this.pvMatrix,this.mMatrix)}},{key:"setTranslation",value:function(t,e,i){void 0!==e&&(this.theta=e),void 0!==i&&(this.phi=i),this.translation=R(this.theta,this.phi,t),this.onViewChanged()}},{key:"setQuat",value:function(t,e,i){quat.fromEuler(this.quat,0,t,e),this.onViewChanged()}},{key:"setScale",value:function(t){this.size=t||this.size,this.vscale=vec3.fromValues(this.size,this.size,this.size),this.onViewChanged()}},{key:"setCurrent",value:function(t){this.current=!0,this.color=new Float32Array([1,0,0]),this.drawMode=v.gl.LINE_LOOP,t*=1.15,this.setScale(t)}},{key:"unsetCurrent",value:function(){this.current=!1,this.color[0]=this.originColor[0],this.color[1]=this.originColor[1],this.color[2]=this.originColor[2],this.drawMode=v.gl.LINES,this.setScale()}}]),e}(A),H="precision mediump float;\r\n\r\nattribute vec3 aVertexPosition;\r\nattribute vec3 aVertexNormal;\r\nattribute vec2 aTexture;\r\nattribute vec3 aColor;\r\n\r\nuniform mat4 uPMVMatrix;\r\nuniform mat4 uMMatrix;\r\nuniform mat4 uNMatrix;\r\nuniform vec3 uVertColor;\r\nuniform bool uSpecColor;\r\n\r\nuniform vec3  uLightDirection; // 直射光的方向\r\nvarying vec3  vLight;\r\nvarying vec2  vTexture;\r\nvarying vec3  vNormal;\r\nvarying vec3  vPosition;\r\n\r\n\r\nvoid main(void) {\r\n    gl_Position = uPMVMatrix * vec4(aVertexPosition, 1.0);\r\n\r\n    vec3 normal = normalize( vec3( uNMatrix * vec4( aVertexNormal, 1 ) ) );\r\n    vNormal = normal;\r\n    vPosition = vec3( uMMatrix * vec4( aVertexPosition , 1.0 ) );\r\n\r\n//    vec3 ambientLight     = vec3( 0.2, 0.24, 0.21 );\r\n//    vec3 directLightColor = vec3( 0.75, 0.75, 0.75 );\r\n//    float directional = max( dot( normal, normalize( uLightDirection ) ), 0.0);\r\n//    vec3 diffuse = directLightColor * directional;\r\n\r\n    if( !uSpecColor ) {\r\n//        vLight = aColor * (ambientLight + diffuse);\r\n        vLight = aColor;\r\n    } else {\r\n//        vLight = uVertColor * (ambientLight + diffuse);\r\n        vLight = uVertColor;\r\n    }\r\n    vTexture = aTexture;\r\n}\r\n",Y="precision mediump float;\r\n\r\nvarying vec3  vLight;\r\nvarying vec2  vTexture;\r\nvarying vec3  vNormal;\r\nvarying vec3  vPosition;\r\n\r\nuniform float uAlpha;\r\nuniform vec3 uFragColor;\r\nuniform bool uHasTexture;\r\nuniform sampler2D uSampler;\r\n\r\n// uniform sampler2D uYSampler;\r\n// uniform sampler2D uZSampler;\r\n// uniform int uEnableTexture;\r\nvoid main(void) {\r\n    vec3 lightPos = vec3( 10, 10, 10 );\r\n    vec3 ambientLight = vec3( 0.28, 0.28, 0.28 );\r\n    vec3 directLightColor = vec3( 0.88, 0.88, 0.88 );\r\n    float directional = max( dot( normalize( vNormal ), normalize( lightPos - vPosition ) ), 0.0);        // 直接使用顶点的法线数据进行漫反射计算\r\n    vec3 diffuse = directLightColor * directional;\r\n\r\n    if( uHasTexture ) {\r\n//        vec4 color = mix( uFragColor, texture2D( uSampler, vec2( vTexture.s, vTexture.t ) ), 0.5 );\r\n        gl_FragColor = vec4( uFragColor * (diffuse + ambientLight), uAlpha );\r\n    }\r\n    else {\r\n        gl_FragColor = vec4( vLight * (diffuse + ambientLight), uAlpha );\r\n    }\r\n//   mediump vec4 xtextureColor = texture2D(uXSampler, vec2(vXTexture.s, vXTexture.t));\r\n//   mediump vec4 ytextureColor = texture2D(uYSampler, vec2(vXTexture.s, vXTexture.t));\r\n//   mediump vec4 ztextureColor = texture2D(uZSampler, vec2(vXTexture.s, vXTexture.t));\r\n//   if( uEnableTexture == 0 ) {\r\n//     gl_FragColor = vec4(vLight, uAlpha);\r\n//   }\r\n//   else if( uEnableTexture == 1 ) {\r\n//     gl_FragColor = vec4(vLight, 1.0) * xtextureColor;\r\n//   }\r\n//   else if( uEnableTexture == 2 ) {\r\n//     gl_FragColor = vec4(vLight, 1.0) * ytextureColor;}\r\n//   else if( uEnableTexture == 3 ) {\r\n//     gl_FragColor = vec4(vLight, 1.0) * ztextureColor;\r\n//   }\r\n}\r\n",W=function(){function t(){Object(f["a"])(this,t),this.attributes=p,this.uniforms=m,this.states=v}return Object(d["a"])(t,[{key:"init",value:function(t){v.gl=t;var e=new T({});this.scene=e,e.initShaders(H,Y),this.camera=new w({height:600,width:800}),e.addCamera(this.camera),this.coord=new O({}),e.add(this.coord)}},{key:"paintGL",value:function(t){var e=t.devicePixelRatio,i=t.width*e,r=t.height*e;i===camera.width&&r===camera.height||this.camera.setSize(i,r),this.scene.render()}},{key:"setAttitude",value:function(t){this.sensorPoint.setParam(t)}},{key:"hideAll",value:function(){this.sensorPoint.visible=!1,this.sensorPath.visible=!1,this.recordPoint.visible=!1,this.refCircle.visible=!1,this.sphere.visible=!1}},{key:"reset",value:function(){this.sensorPoint.reset(),this.sensorPath.resetAllPath(),this.camera.reset()}},{key:"defaultInit",value:function(){this.addIndicator(),this.addSensorPath(),this.addRefCircle(),this.addRecordPoint(),this.addSphere()}},{key:"addIndicator",value:function(t){t=t||{color:[1,.2,.1]},this.sensorPoint=new B(t),this.sensorPoint.init(),this.sensorPoint.setParam({dis:4,pitch:0,roll:0,heading:0}),this.scene.add(this.sensorPoint,!0)}},{key:"addSensorPath",value:function(t){void 0===this.sensorPath&&(t=t||{color:[.9,.5,.2]},this.sensorPath=new I(t),this.scene.add(this.sensorPath,!0),this.sensorPoint.addSphericalChange(this.sensorPath))}},{key:"addRecordPoint",value:function(t){void 0===this.recordPoint&&(this.recordPoint=new z(t),this.scene.add(this.recordPoint,!0),this.sensorPoint.addSphericalChange(this.recordPoint),this.sensorPoint.update())}},{key:"addRefCircle",value:function(t){void 0===this.refCircle&&(this.refCircle=new U(t),this.scene.add(this.refCircle,!0),this.sensorPoint.addSphericalChange(this.refCircle),this.sensorPoint.update())}},{key:"addSphere",value:function(t){void 0===this.sphere&&(t=t||{color:[.95,.2,.2],vn:48,hn:48},this.sphere=new N(t),this.sphere.init(),this.scene.add(this.sphere))}},{key:"addCraft",value:function(t){void 0===this.craft&&(this.craft=new j(t||{}),this.scene.add(this.craft,!0),this.sensorPoint.addSphericalChange(this.craft),this.sensorPoint.update())}},{key:"resizeGL",value:function(t){var e=t.devicePixelRatio;t.pixelSize=Qt.size(t.width*e,t.height*e)}}]),t}();window.SpacePath=W;var $=new W;function G(t){return 180*t/Math.PI}var X={camera:null,dwy:0,wratio:.01,dragged:!1,dx:0,dy:0,lastPos:null,curPos:null,yratio:.25,xratio:.3};function q(t){return X.dwy=t.deltaY*X.wratio+X.camera.dis,X.camera.rotate(null,null,X.dwy),t.preventDefault(),!1}function J(t){X.dragged=!1}function Z(t){X.curPos=K(X.canvas,t),X.dragged&&(X.dx=(X.lastPos.x-X.curPos.x)*X.xratio+G(X.camera.phi),X.dy=(X.lastPos.y-X.curPos.y)*X.yratio+G(X.camera.theta),X.dx<0?X.dx+=360:X.dx>360&&(X.dx-=360),X.camera.rotate(X.dy,X.dx),X.lastPos=X.curPos)}function Q(t){X.lastPos=K(X.canvas,t),X.dragged=!0}function K(t,e){var i=t.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}var tt=i("5118"),et=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-card",{attrs:{header:"相机设置"}},[i("b-btn",{on:{click:function(e){return t.resetCamera()}}},[t._v("重置位置")]),i("div",[t._v("\n    摄像机θ角(与Z轴正半轴夹角): "+t._s(t.cameraTheta.toFixed(1))+"\n    "),i("b-form-input",{attrs:{type:"range",id:"cameraTheta",value:t.cameraTheta,min:"0",max:"180"},on:{change:function(e){return t.cameraThetaChanged(e)}}})],1),i("div",[t._v("\n    摄像机φ角(与X轴正半轴夹角): "+t._s(t.cameraPhi.toFixed(1))+"\n    "),i("b-form-input",{attrs:{type:"range",id:"cameraPhi",value:t.cameraPhi,min:"0",max:"360"},on:{change:function(e){return t.cameraPhiChanged(e)}}})],1),i("div",[t._v("\n    摄像机距原点: "+t._s(t.cameraDis.toFixed(1))+"\n    "),i("b-form-input",{attrs:{type:"range",id:"cameraDis",value:t.cameraDis,min:"1",max:"180"},on:{change:function(e){return t.cameraDisChanged(e)}}})],1),i("b-checkbox",{model:{value:t.sphereCoord,callback:function(e){t.sphereCoord=e},expression:"sphereCoord"}},[t._v("球坐标系")])],1)},it=[],rt={props:{camera:{type:Object,default:{theta:0,phi:0,dis:4}}},data:function(){return{sphereCoord:!0}},computed:{cameraPhi:function(){return G(this.camera.phi)},cameraTheta:function(){return G(this.camera.theta)},cameraDis:function(){return this.camera.dis}},methods:{cameraPhiChanged:function(t){this.camera.rotate(null,t,null)},cameraThetaChanged:function(t){this.camera.rotate(t,null,null)},cameraDisChanged:function(t){this.camera.rotate(null,null,t)},resetCamera:function(){this.camera.reset()}}},nt=rt,at=i("2877"),st=Object(at["a"])(nt,et,it,!1,null,null,null),ot=st.exports,ht=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-card",{class:{nopadding:!t.sphere.visible},attrs:{header:"球体参数设置"}},[i("template",{slot:"header"},[i("b-checkbox",{model:{value:t.sphere.visible,callback:function(e){t.$set(t.sphere,"visible",e)},expression:"sphere.visible"}},[t._v("显示球体")])],1),t.sphere.visible?i("b-card-body",[i("div",[t._v("\n      参考球半径: "+t._s(t.sphere.size)+"\n      "),i("b-form-input",{attrs:{type:"range",id:"sphereRadius",value:t.sphere.size,min:"1",max:"10"},on:{change:function(e){return t.sphereRadiusChanged(e)}}})],1),i("div",[t._v("球面透明度: "+t._s(t.sphereAlpha)+"\n      "),i("b-form-input",{attrs:{type:"range",id:"sphereOpacity",value:t.sphereAlpha,min:"0",max:"100"},on:{change:function(e){t.sphere.alpha=parseFloat(e)/100}}})],1),i("b-form-group",{attrs:{label:"绘制球体的模式"}},[i("b-radio-group",{staticClass:"sphereMode",model:{value:t.sphere.drawMode,callback:function(e){t.$set(t.sphere,"drawMode",e)},expression:"sphere.drawMode"}},[i("div",[i("b-radio",{attrs:{value:0}},[t._v("Surface")])],1),i("div",[i("b-radio",{attrs:{value:1}},[t._v("Line")])],1),i("div",[i("b-radio",{attrs:{value:2}},[t._v("lessLine")])],1)])],1)],1):t._e()],2)},lt=[],ct={props:{sphere:{type:Object,default:{size:4,alpha:1,drawMode:0}}},computed:{sphereAlpha:function(){return 100*this.sphere.alpha}},methods:{sphereRadiusChanged:function(t){this.sphere.setSize(t)}}},ut=ct,ft=Object(at["a"])(ut,ht,lt,!1,null,null,null),dt=ft.exports,vt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("b-card",{class:{nopadding:!t.craft.visible},attrs:{header:"模拟器参数设置"}},[i("template",{slot:"header"},[i("b-checkbox",{on:{change:function(e){return t.paintCraft(e)}}},[t._v("绘制模拟器")])],1),t.craft.visible?i("b-card-body",[i("div",{class:{disable:!t.craft.visible}},[t._v("\n      模拟器大小: "+t._s(t.craft.size)+"\n      "),i("b-form-input",{attrs:{type:"range",id:"craftSize",value:t.craft.size,min:"0.1",max:"3",step:"0.1"},on:{change:function(e){return t.setCraftSize(e)}}})],1),i("div",{},[t._v("\n      模拟器headingOffset: "+t._s(t.craft.headingOffset)+"\n      "),i("b-form-input",{attrs:{type:"range",id:"craftHO",value:t.craft.headingOffset,min:"0",max:"360",step:"45"},on:{change:function(e){return t.changeHeadingOffset(e)}}})],1),i("div",{},[t._v("\n      模拟器pitchOffset: "+t._s(t.craft.pitchOffset)+"\n      "),i("b-form-input",{attrs:{type:"range",id:"craftPO",value:t.craft.pitchOffset,min:"0",max:"180",step:"45"},on:{change:function(e){return t.changePitchOffset(e)}}})],1),i("div",{},[t._v("\n      模拟器rollOffset: "+t._s(t.craft.rollOffset)+"\n      "),i("b-form-input",{attrs:{type:"range",id:"craftRO",value:t.craft.rollOffset,min:"0",max:"360",step:"45"},on:{change:function(e){return t.changeRollOffset(e)}}})],1)]):t._e()],2)},gt=[],pt={props:{craft:Object},methods:{paintCraft:function(t){t&&this.$emit("initCraft"),this.craft.visible=t},changePitchOffset:function(t){this.craft.pitchOffset=l()(t)},changeHeadingOffset:function(t){this.craft.headingOffset=l()(t)},changeRollOffset:function(t){this.craft.rollOffset=l()(t)}}},mt=pt,xt=(i("867a"),Object(at["a"])(mt,vt,gt,!1,null,null,null)),bt=xt.exports,_t=i.e("chunk-2d221f75").then(i.bind(null,"cd31")),At={components:{CameraSetting:ot,SphereSetting:dt,CraftSetting:bt},data:function(){return{scene:{running:!0},camera:{theta:0,phi:0,dis:4},sphere:{size:4,alpha:1,drawMode:0},indicator:{size:1},sensorPath:{visible:!0,size:1},refCircle:{visible:!0,size:1},craft:{visible:!1,size:1,headingOffset:0,pitchOffset:0,rollOffset:0}}},computed:{indicatorSize:function(){return 100*this.indicator.size},pathWidth:function(){return this.sensorPath.size}},methods:{setSceneRun:function(t){t&&this.scene.render()},recordPoint:function(){this.spacepath.recordPoint.record();var t=o()({type:"action",record:!0});this.$socket.send(t)},resetRecordedPoint:function(){this.spacepath.recordPoint.reset();var t=o()({type:"action",resetRecord:!0});this.$socket.send(t)},setIndicatorSize:function(t){this.indicator.setScale(l()(t)/100)},setPathWidth:function(t){this.sensorPath.setSize(t)},setRefCircleSize:function(t){this.refCircle.setScale(l()(t))},setCraftSize:function(t){this.craft.visible&&this.craft.setScale(t)},initCraft:function(){this.spacepath.addCraft({}),this.craft=this.spacepath.craft,this.craft.init(_t),this.craft.headingOffset=270,this.craft.pitchOffset=90,this.craft.setRotation({})},resetPath:function(){this.sensorPath.resetAllPath()},init:function(t){this.spacepath=t,this.scene=t.scene,this.camera=t.camera,t.sphere&&(this.sphere=t.sphere),t.sensorPoint&&(this.indicator=t.sensorPoint,this.indicator.setScale(.4)),t.sensorPath&&(this.sensorPath=t.sensorPath),t.refCircle&&(this.refCircle=t.refCircle,this.refCircle.setScale(.5))}},mounted:function(){var t=this;console.log("Sidebar Mounted"),Object(tt["setTimeout"])(function(){t.init($)},500)}},yt=At,St=Object(at["a"])(yt,c,u,!1,null,null,null),Ct=St.exports,Pt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",[t._v("Heading: "+t._s(t.heading))]),i("div",[t._v("Picth: "+t._s(t.pitch))]),i("div",[t._v("Roll: "+t._s(t.roll))])])},Mt=[],Rt={props:{data:Object},computed:{heading:function(){return this.data.heading?this.data.heading.toFixed(2):0},pitch:function(){return this.data.pitch?this.data.pitch.toFixed(2):0},roll:function(){return this.data.roll?this.data.roll.toFixed(2):0}}},Et=Rt,Ot=Object(at["a"])(Et,Pt,Mt,!1,null,null,null),wt=Ot.exports,Tt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",[t._v("Heading: "+t._s(t.heading)+"\n    "),i("b-form-input",{attrs:{type:"range",id:"heading",value:t.data.heading,min:"0",max:"360"},on:{change:function(e){return t.$emit("valueChanged",{key:"heading",value:e})}}})],1),i("div",[t._v("Picth: "+t._s(t.data.pitch.toFixed(2))+"\n    "),i("b-form-input",{attrs:{type:"range",id:"pitch",value:t.data.pitch,min:"-90",max:"90"},on:{change:function(e){return t.$emit("valueChanged",{key:"pitch",value:e})}}})],1),i("div",[t._v("Roll: "+t._s(t.data.roll.toFixed(2))+"\n    "),i("b-form-input",{attrs:{type:"range",id:"roll",value:t.data.roll,min:"0",max:"180"},on:{change:function(e){return t.$emit("valueChanged",{key:"roll",value:e})}}})],1)])},Bt=[],kt={props:{data:Object},computed:{heading:function(){return this.data.heading.toFixed(2)}}},Ft=kt,Lt=Object(at["a"])(Ft,Tt,Bt,!1,null,null,null),It=Lt.exports,zt={name:"app",components:{CSidebar:Ct,CInformation:wt,CDebugPanel:It},data:function(){return{canvasWidth:800,canvasHeight:600,data:{heading:0,pitch:0,roll:0},showSidebar:!0,showDebugInfo:!0}},created:function(){},mounted:function(){var t=this;this.$debug={heading:0,pitch:0,roll:0},console.log("SpacePath is Mounted");var e=this.$refs.canvas,i=e.getContext("webgl",{depth:!0,antilias:!0});this.spacepath=$,this.spacepath.init(i),this.spacepath.defaultInit(),this.spacepath.scene.render(),X.camera=this.spacepath.camera,X.canvas=e;var r=this.$refs.panel;r.addEventListener("mousedown",Q),r.addEventListener("mousemove",Z),r.addEventListener("mouseup",J),r.addEventListener("wheel",q,!1),this.canvasWidth=window.innerWidth,this.canvasHeight=window.innerHeight,this.spacepath.camera.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",function(e){t.canvasWidth=window.innerWidth-2,t.canvasHeight=window.innerHeight-2,t.spacepath.camera.setSize(t.canvasWidth,t.canvasHeight)}),this.registerSockets()},methods:{debugValueChanged:function(t){this.$set(this.data,t.key,l()(t.value)),this.spacepath.setAttitude(this.data)},registerSockets:function(){var t=this;this.$options.sockets.onmessage=function(e){var i=JSON.parse(e.data);"feedHPR"===i.type?(t.data.heading=i.heading,t.data.pitch=i.pitch,t.data.roll=i.roll,t.spacepath.setAttitude(t.data)):"action"===i.type&&(i.resetRecord&&t.spacepath.recordPoint.reset(),i.record&&t.spacepath.recordPoint.record(),i.resetPath&&t.spacepath.sensorPath.resetAllPath(),t.$socket.send(o()({idx:i.idx,status:"ok"})))}}},sockets:{connect:function(){console.log("socket connected")},feedHPR:function(t){this.data=t,this.spacepath.setAttitude(t)},action:function(t){t.resetRecord&&this.spacepath.recordPoint.reset(),t.record&&this.spacepath.recordPoint.record(),t.resetPath&&this.spacepath.sensorPath.resetAllPath(),this.$socket.emit("response",{idx:t.idx,status:"ok"})}}},jt=zt,Nt=(i("034f"),Object(at["a"])(jt,n,a,!1,null,null,null)),Dt=Nt.exports,Ut=i("9f7b"),Vt=i.n(Ut),Ht=(i("f9e3"),i("2dd8"),i("b408")),Yt=i.n(Ht);r["a"].use(Vt.a);var Wt=4900,$t="/",Gt="ws://localhost:"+Wt+$t;console.info("socketio:",Gt),r["a"].use(Yt.a,Gt,{format:"json"}),r["a"].config.productionTip=!1;new r["a"]({render:function(t){return t(Dt)}}).$mount("#app")},"64a9":function(t,e,i){},"867a":function(t,e,i){"use strict";var r=i("3855"),n=i.n(r);n.a}});
//# sourceMappingURL=index.279f6866.js.map